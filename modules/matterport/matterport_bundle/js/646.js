/*! For license information please see 646.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[646],{14766:(e,t,o)=>{o.d(t,{m:()=>r});var n=o(88977),s=o(7689);const i={0:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y,1:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z,2:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X,3:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,4:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X,5:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y},r=e=>{if(e<0||e>5)throw new s.Z("mapFaceToCubemapFace() -> face must be in the range [0, 5]");return i[e]}},77382:(e,t,o)=>{var n;o.d(t,{Z:()=>s}),function(e){e[e.Center=0]="Center",e[e.UpperLeft=1]="UpperLeft",e[e.UpperRight=2]="UpperRight",e[e.LowerRight=3]="LowerRight",e[e.LowerLeft=4]="LowerLeft"}(n||(n={}));const s=n},27646:(e,t,o)=>{o.d(t,{S:()=>u,Z:()=>h});var n=o(76609),s=o(71239),i=o(54730),r=o(55084),a=o(46950);const l=new(o(97998).Z)("panoqualitymanager");var u;!function(e){e[e.Untested=0]="Untested",e[e.Testing=1]="Testing",e[e.Success=2]="Success",e[e.Fail=3]="Fail"}(u||(u={}));class h{constructor(e,t,o,n,r){this.urls=e,this.maxCubemapSize=t,this.maxNavPanoSize=o,this.maxZoomPanoSize=n,this.overrideWindow=!1,this.navPanoSize=-1,this.zoomPanoSize=-1,this.resolution=r,this.highQualityThreshold=s.Xd.windowHeightHighQualityThresholdOverride||s.Xd.windowHeightHighQualityThreshold,this.persistentStorage=new i.a,this.downloadTestResults={},this.updateMaximums()}setResolution(e){this.resolution=e,this.updateMaximums()}overrideWindowMaximums(e){this.overrideWindow=e,this.updateMaximums()}overrideNavPanoSize(e){this.maxNavPanoSize=e,this.updateMaximums()}getTestResults(e,t){const o=this.downloadTestResults[e];if(o){const e=o[t];if(e)return e}return u.Untested}ultraHighQualityModeEnabled(e){const t=n.Qf[this.getZoomPanoSize()],o=this.downloadTestResults[e];return!(!o||!o[t])&&o[t]===u.Success}updateMaximums(){this.resolution<this.highQualityThreshold&&!this.overrideWindow?(this.navPanoSize=Math.min(h.getPanoSize(n.SL.STANDARD),this.maxNavPanoSize),this.zoomPanoSize=Math.min(h.getPanoSize(n.SL.HIGH),this.maxZoomPanoSize)):(this.navPanoSize=this.maxNavPanoSize,this.zoomPanoSize=this.maxZoomPanoSize),this.zoomPanoSize<this.navPanoSize&&(this.navPanoSize=this.zoomPanoSize),this.zoomPanoSize=Math.min(this.maxCubemapSize,this.zoomPanoSize),this.navPanoSize=Math.min(this.maxCubemapSize,this.navPanoSize)}static getPanoSize(e){if(e in n.eE)return n.eE[e];throw new Error(`Not a panoSizeClass: ${e}`)}static getPanoSizeClass(e){if(e in n.Qf)return n.Qf[e];throw new Error(`Not a valid pano resolution: ${e}`)}getMaxPossiblePanoSize(){return h.getPanoSize(n.SL.ULTRAHIGH)}getNavPanoSize(){return this.navPanoSize}getZoomPanoSize(){return this.zoomPanoSize}availableResolution(e,t){const o=new a.Q;if(!t)return o.reject(0);if(e.resolutions)return e.resolutions.includes(t)?o.resolve(t):this.availableResolution(e,this.getLowerResolution(t));switch(this.getTestResults(e.id,t)){case u.Success:o.resolve(t);break;case u.Fail:return this.availableResolution(e,this.getLowerResolution(t));case u.Untested:this.testDownload(e,t,r.I_).then((n=>{n?o.resolve(t):this.availableResolution(e,this.getLowerResolution(t)).then((e=>o.resolve(e)))}));break;case u.Testing:l.warn("resolution is already testing, do we need to handle this?")}return o}getLowerResolution(e){switch(e){case n.SL.ULTRAHIGH:return n.SL.HIGH;case n.SL.HIGH:return n.SL.STANDARD;case n.SL.STANDARD:return n.SL.BASE}return null}testDownload(e,t,o){if(!this.urls)throw new Error("Can't call testDownload without signed urls");const n=h.getPanoSize(t),s=new a.Q,i=e.id;this.downloadTestResults[i]||(this.downloadTestResults[i]={});const r=this.downloadTestResults[i]&&this.downloadTestResults[i][t];if(r)r===u.Success?s.resolve(!0):r===u.Fail&&s.resolve(!1);else{this.downloadTestResults[i][t]=u.Testing;const r=e=>{this.downloadTestResults[i][t]=u.Success,s.resolve(!0)},a=()=>{this.downloadTestResults[i][t]=u.Fail,s.resolve(!1)};this.getTileUrl(e,n,o,0).then((e=>{this.urls.getImage(e).then(r,a)}))}return s}getTileUrl(e,t,o,n){const s=this.persistentStorage.get("getTileUrl:locationInfo",(()=>({face:-1,faceTileIndex:-1,tileX:-1,tileY:-1})));r.Tp(t,n,s);const i=Math.floor(t/o),a=i*i,l=Math.floor(n/a),u=h.getPanoSizeClass(t);return e.getTileUrl(u,l,s.tileX,s.tileY)}}},55084:(e,t,o)=>{o.d(t,{Hq:()=>u,I_:()=>l,P6:()=>h,R5:()=>c,Tp:()=>T,Tu:()=>d,eO:()=>g,oU:()=>S,ym:()=>w});var n=o(88977),s=o(81396),i=o(77382),r=o(14766),a=o(69505);const l=512,u=6,h=(e,t,o,s,r,a,l,u)=>{const h=e/t,c=2*(t/e),T=c/2;let d=2*(s/h)-1+T,w=2*((r=h-1-r)/h)-1+T;switch(a=a||i.Z.Center){case i.Z.UpperLeft:d-=T,w+=T,d+=l*c;break;case i.Z.UpperRight:d+=T,w+=T,w-=l*c;break;case i.Z.LowerRight:d+=T,w-=T,d-=l*c;break;case i.Z.LowerLeft:d-=T,w-=T,w+=l*c;break;case i.Z.Center:}switch(o){case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X:u.set(-1,w,-d);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:u.set(1,w,d);break;case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:u.set(-d,1,-w);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:u.set(-d,-1,w);break;case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:u.set(-d,w,1);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:u.set(d,w,-1)}u.normalize()},c=(e,t)=>{let o=l;e<l&&(o=e);const n=Math.floor(e/o),s=n*n;return Math.floor(t/s)},T=(e,t,o)=>{let n=l;e<l&&(n=e);const s=c(e,t),i=Math.floor(e/n),r=t-s*(i*i);o.tileX=r%i,o.tileY=Math.floor(r/i),o.face=s,o.faceTileIndex=r},d=function(e){if(e<=l)return u;const t=Math.floor(e/l);return t*t*u},w=function(){const e=new s.Matrix4,t=new s.Quaternion;return(o,n)=>{t.copy(o),t.invert(),e.makeRotationFromQuaternion(t),n.applyMatrix4(e),n.normalize()}}(),S=function(){const e=new s.Vector3,t=new s.Vector3(0,0,-1),o=new s.Quaternion,n=function(e,t){e.push({face:t.face,faceTileIndex:t.faceTileIndex,tileX:t.tileX,tileY:t.tileY})},i=function(){const e={face:-1,faceTileIndex:-1,tileX:-1,tileY:-1};return(t,o,s)=>{const i=d(t);let r=0;for(let a=0;a<i;a++)T(t,a,e),o&&!o(e)||(r++,s&&n(s,e));return r}}();return(n,r,a,u,h=!1,c,T)=>{u.length=h?0:u.length;const d=r<l?r:l;if(!c&&!T)return i(r,null,u);const S=!!T;c=c||0,T=T||c,T=Math.max(0,Math.min(T,360)),c=Math.max(0,Math.min(c,360)),e.copy(a);const _=n.rotation||new s.Quaternion;if(w(_,e),S){o.setFromUnitVectors(e,t);return i(r,(function(e){return f(r,d,e.face,e.tileX,e.tileY,o,c||0,T||0)}),u)}return i(r,(function(t){return g(r,d,t.face,t.tileX,t.tileY,e,c||0)}),u)}}(),f=function(){const e=new s.Vector3;return(t,o,n,s,l,u,c,T)=>{const d=Math.tan(.5*T*a.Ue),w=-d,S=Math.tan(.5*c*a.Ue),f=-S,g=(0,r.m)(n);let _=0,m=0,E=0,P=0,z=0;for(let n=i.Z.Center;n<=i.Z.LowerLeft;n++){if(h(t,o,g,s,l,n,0,e),e.applyQuaternion(u),e.z>=-1e-5)continue;const i=-1/e.z,r=e.x*i,a=e.y*i;a>d?_++:a<w&&m++,r>S?E++:r<f&&P++,z++}return m!==z&&_!==z&&E!==z&&P!==z}}(),g=function(){const e=new s.Vector3,t=new s.Vector3(0,1,0),o=new s.Vector3(1,0,0);return(n,s,a,l,u,c,T)=>{const d=(0,r.m)(a);if(o.copy(c).cross(t),h(n,s,d,l,u,i.Z.Center,0,e),_(e,c,T))return!0;const w=T/360,S=Math.floor(1/w);let f=0;for(let t=0;t<S;t++){for(let t=i.Z.UpperLeft;t<=i.Z.LowerLeft;t++)if(h(n,s,d,l,u,t,f,e),_(e,c,T))return!0;f+=w}return!1}}(),_=function(){const e=new s.Vector3,t=new s.Vector3;return(o,n,s,i)=>{if(t.copy(o),i){e.copy(i),e.normalize();const n=e.dot(o);e.x*=n,e.y*=n,e.z*=n,t.sub(e)}const r=s/2*a.Ue,l=Math.cos(r);return t.dot(n)>=l}}()},54730:(e,t,o)=>{o.d(t,{a:()=>s});class n{constructor(e){this._value=e}value(){return this._value}set(e){this._value=e}}class s{constructor(){this.storage={}}get(e,t){let o=this.storage[e];return o||(o=t(),this.storage[e]=o),o}getNumber(e){return this.get(e,(()=>new n(0)))}getString(e){return this.get(e,(()=>new n("")))}getArray(e){return this.get(e,(()=>[]))}getNumberMap(e){return this.get(e,(()=>({})))}getStringMap(e){return this.get(e,(()=>({})))}}}}]);