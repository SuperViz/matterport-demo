/*! For license information please see 316.js.LICENSE.txt */
(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[316],{34515:e=>{var t=Object.prototype.toString;e.exports=function(e){return e.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===t.call(e.buffer)||Array.isArray(e)}},14176:e=>{e.exports=function(e,t){return"number"==typeof e?e:"number"==typeof t?t:0}},2823:e=>{e.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},48738:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},73134:(e,t,i)=>{var s=i(12739),n=i(47529),o=i(14176),r=["x","e","a","o","n","s","r","c","u","m","v","w","z"],a=["m","w"],h=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],c="\t".charCodeAt(0),l=" ".charCodeAt(0);function u(e){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}function d(e){return function(){return this["_"+e]}}function p(e,t){if(!e.chars||0===e.chars.length)return null;var i=f(e.chars,t);return i>=0?e.chars[i]:null}function g(e,t,i){if(!e.kernings||0===e.kernings.length)return 0;for(var s=e.kernings,n=0;n<s.length;n++){var o=s[n];if(o.first===t&&o.second===i)return o.amount}return 0}function f(e,t,i){for(var s=i=i||0;s<e.length;s++)if(e[s].id===t)return s;return-1}e.exports=function(e){return new u(e)},u.prototype.update=function(e){if(e=n({measure:this._measure},e),this._opt=e,this._opt.tabSize=o(this._opt.tabSize,4),!e.font)throw new Error("must provide a valid bitmap font");var t=this.glyphs,i=e.text||"",a=e.font;this._setupSpaceGlyphs(a);var c=s.lines(i,e);t.length=0;var l=c.reduce((function(e,t){return Math.max(e,t.width,0)}),0),u=0,d=0,p=o(e.lineHeight,a.common.lineHeight),m=a.common.base,y=p-m,w=e.letterSpacing||0,b=p*c.length-y,x=function(e){if("center"===e)return 1;if("right"===e)return 2;return 0}(this._opt.align);d-=b,this._width=l,this._height=b,this._descender=p-m,this._baseline=m,this._xHeight=function(e){for(var t=0;t<r.length;t++){var i=r[t].charCodeAt(0),s=f(e.chars,i);if(s>=0)return e.chars[s].height}return 0}(a),this._capHeight=function(e){for(var t=0;t<h.length;t++){var i=h[t].charCodeAt(0),s=f(e.chars,i);if(s>=0)return e.chars[s].height}return 0}(a),this._lineHeight=p,this._ascender=p-y-this._xHeight;var v=this;c.forEach((function(e,s){for(var n,o=e.start,r=e.end,h=e.width,c=o;c<r;c++){var f=i.charCodeAt(c),m=v.getGlyph(a,f);if(m){n&&(u+=g(a,n.id,m.id));var y=u;1===x?y+=(l-h)/2:2===x&&(y+=l-h),t.push({position:[y,d],data:m,index:c,line:s}),u+=m.xadvance+w,n=m}}d+=p,u=0})),this._linesTotal=c.length},u.prototype._setupSpaceGlyphs=function(e){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,e.chars&&0!==e.chars.length){var t=p(e,l)||function(e){for(var t=0;t<a.length;t++){var i=a[t].charCodeAt(0),s=f(e.chars,i);if(s>=0)return e.chars[s]}return 0}(e)||e.chars[0],i=this._opt.tabSize*t.xadvance;this._fallbackSpaceGlyph=t,this._fallbackTabGlyph=n(t,{x:0,y:0,xadvance:i,id:c,xoffset:0,yoffset:0,width:0,height:0})}},u.prototype.getGlyph=function(e,t){var i=p(e,t);return i||(t===c?this._fallbackTabGlyph:t===l?this._fallbackSpaceGlyph:null)},u.prototype.computeMetrics=function(e,t,i,s){var n,o=this._opt.letterSpacing||0,r=this._opt.font,a=0,h=0,c=0;if(!r.chars||0===r.chars.length)return{start:t,end:t,width:0};i=Math.min(e.length,i);for(var l=t;l<i;l++){var u,d=e.charCodeAt(l);if(u=this.getGlyph(r,d)){u.xoffset;var p=(a+=n?g(r,n.id,u.id):0)+u.xadvance+o,f=a+u.width;if(f>=s||p>=s)break;a=p,h=f,n=u}c++}return n&&(h+=n.xoffset),{start:t,end:t+c,width:h}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(e){Object.defineProperty(u.prototype,e,{get:d(e),configurable:!0})}))},77824:(e,t,i)=>{var s=i(2823),n=i(34515),o=i(48738),r=[0,2,3],a=[2,1,3];e.exports=function(e,t){e&&(n(e)||o(e))||(t=e||{},e=null);for(var i="string"==typeof(t="number"==typeof t?{count:t}:t||{}).type?t.type:"uint16",h="number"==typeof t.count?t.count:1,c=t.start||0,l=!1!==t.clockwise?r:a,u=l[0],d=l[1],p=l[2],g=6*h,f=e||new(s(i))(g),m=0,y=0;m<g;m+=6,y+=4){var w=m+c;f[w+0]=y+0,f[w+1]=y+1,f[w+2]=y+2,f[w+3]=y+u,f[w+4]=y+d,f[w+5]=y+p}return f}},45837:(e,t,i)=>{"use strict";i.d(t,{Y:()=>l});var s=i(73134),n=i.n(s),o=i(77824),r=i.n(o);const a={min:[0,0],max:[0,0]};function h(e){const t=e.length/2;a.min[0]=e[0],a.min[1]=e[1],a.max[0]=e[0],a.max[1]=e[1];for(let i=0;i<t;i++){const t=e[2*i+0],s=e[2*i+1];a.min[0]=Math.min(t,a.min[0]),a.min[1]=Math.min(s,a.min[1]),a.max[0]=Math.max(t,a.max[0]),a.max[1]=Math.max(s,a.max[1])}}var c=i(81396);function l(e){return new u(e)}class u extends c.BufferGeometry{constructor(e){super(),this.type="TextGeometry","string"==typeof e&&(e={text:e}),this._opt=Object.assign({},e),e&&this.update(e)}update(e){if("string"==typeof e&&(e={text:e}),!(e=Object.assign({},this._opt,e)).font)throw new TypeError("must specify a { font } in options");this.layout=n()(e);const t=!1!==e.flipY,i=e.font,s=i.common.scaleW,o=i.common.scaleH,a=this.layout.glyphs.filter((function(e){const t=e.data;return t.width*t.height>0}));this.visibleGlyphs=a;const h=function(e){const t=new Float32Array(4*e.length*2);let i=0;return e.forEach((function(e){const s=e.data,n=e.position[0]+s.xoffset,o=e.position[1]+s.yoffset,r=s.width,a=s.height;t[i++]=n,t[i++]=o,t[i++]=n,t[i++]=o+a,t[i++]=n+r,t[i++]=o+a,t[i++]=n+r,t[i++]=o})),t}(a),l=function(e,t,i,s){const n=new Float32Array(4*e.length*2);let o=0;return e.forEach((function(e){const r=e.data,a=r.x+r.width,h=r.y+r.height,c=r.x/t;let l=r.y/i;const u=a/t;let d=h/i;s&&(l=(i-r.y)/i,d=(i-h)/i),n[o++]=c,n[o++]=l,n[o++]=c,n[o++]=d,n[o++]=u,n[o++]=d,n[o++]=u,n[o++]=l})),n}(a,s,o,t),u=r()([],{clockwise:!0,type:"uint16",count:a.length});this.setIndex(u),this.setAttribute("position",new c.BufferAttribute(h,2)),this.setAttribute("uv",new c.BufferAttribute(l,2)),!e.multipage&&"page"in this.attributes?this.deleteAttribute("page"):e.multipage&&this.setAttribute("page",new c.BufferAttribute(function(e){const t=new Float32Array(4*e.length*1);let i=0;return e.forEach((function(e){var s=e.data.page||0;t[i++]=s,t[i++]=s,t[i++]=s,t[i++]=s})),t}(a),1))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new c.Sphere);const e=this.attributes.position.array,t=this.attributes.position.itemSize;if(!e||!t||e.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);!function(e,t){h(e);const i=a.min[0],s=a.min[1],n=a.max[0]-i,o=a.max[1]-s,r=Math.sqrt(n*n+o*o);t.center.set(i+n/2,s+o/2,0),t.radius=r/2}(e,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere():\nComputed radius is NaN. The\n"position" attribute is likely to have NaN values.')}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new c.Box3);const e=this.boundingBox,t=this.attributes.position.array,i=this.attributes.position.itemSize;!t||!i||t.length<2?e.makeEmpty():function(e,t){h(e),t.min.set(a.min[0],a.min[1],0),t.max.set(a.max[0],a.max[1],0)}(t,e)}}},76381:(e,t,i)=>{"use strict";i.r(t),i.d(t,{NavigationVisuals:()=>p,default:()=>m,visDollhouseNavigation:()=>f,visPanoNavigation:()=>g});var s=i(69170),n=i(17798),o=i(2569),r=i(20043),a=i(88338),h=i(9037),c=i(85992),l=i(53954),u=i(23254),d=i(34029);class p{constructor(e,t,i){this.engine=e,this.dynamicNumber=t,this.smoothWalk=i,this.active=!1,this.draw=new n.M,Promise.all([this.engine.getModuleBySymbol(s.y.WEBGL_RENDERER),this.engine.market.waitForData(c.P),this.engine.getModuleBySymbol(s.y.MESH_QUERY),this.engine.market.waitForData(d.e)]).then((([e,t,i,s])=>{var n;this.meshQuery=i,this.draw.setStyle({assetBasePath:null!==(n=s.getProperty("assetBasePath"))&&void 0!==n?n:""}),this.draw.addToScene(e.getScene()),this.subscription=t.onChanged((()=>this.update(this.draw,t))),this.subscription.cancel()})),this.engine.getModuleBySymbol(s.y.SETTINGS).then((e=>{const t="Navigation";[{header:t,setting:"navDebugEnabled",initialValue:()=>this.active,onChange:e=>this.toggle(e),urlParam:!0},{header:t,setting:"Max transition dist",initialValue:()=>a.E.longerTransitionMaxDist,range:[3,50],rangePrecision:1,onChange:e=>a.E.longerTransitionMaxDist=e},{header:t,setting:"accel",initialValue:()=>this.dynamicNumber.acceleration,range:[1,60],rangePrecision:.5,onChange:e=>{this.dynamicNumber.setAccel(e)}},{header:t,setting:"top speed",initialValue:()=>this.dynamicNumber.maxSpeed,range:[1,40],rangePrecision:.5,onChange:e=>this.dynamicNumber.setMaxSpeed(e)},{header:t,setting:"queue ms",initialValue:()=>this.smoothWalk.repeatedQueueDelayMS,range:[0,1e3],onChange:e=>this.smoothWalk.repeatedQueueDelayMS=e}].forEach((t=>e.registerMenuEntry(t)))}))}toggle(e){this.active!==e&&(e||this.draw.toggleAll(!1),e||this.subscription.cancel(),e&&this.subscription.renew(),this.active=e)}update(e,t){const i=this.engine.market.tryGetData(l.Z),s=this.engine.market.tryGetData(h.M),n=this.engine.market.tryGetData(u.O);e&&i&&s&&n&&(e.toggleAll(!1),t.hit&&this.meshQuery.floorIdFromObject(t.hit.object)&&(n.isInside()?g(e,i,s,t.hit.intersection):f(e,i,t.hit.intersection,this.meshQuery)))}}const g=(e,t,i,s)=>{let n=0;const a=s.point.clone().sub(i.pose.position),h=(0,r.Tq)(t,a),c=Math.max(...h.map((e=>e.score))),l=c-5;for(const{sweep:t,score:i}of h)if(t){const r=0===n?"cyan":"orange",a=(0,o.dS)(i,l,c,0,.6);e.line("panosphere"+n++,r).toggle(!0).updatePositions(s.point,t.position).opacity(a);const h=(0,o.dS)(a,0,.6,0,.1);e.sphere("panosphere"+n++,{color:r,opacity:.8}).toggle(!0).update(t.position,h)}},f=(e,t,i,s)=>{let n=0;const a=(0,r.bG)(t,!1,i,s),h=Math.max(...a.map((e=>e.score))),c=h-15;for(const{sweep:t,score:s}of a)if(t){const r=0===n?"cyan":"orange",a=(0,o.dS)(s,c,h,0,1);e.line("panosphere"+n++,r).toggle(!0).updatePositions(i.point,t.position).opacity(a);const l=(0,o.dS)(a,0,1,0,.3);e.sphere("panosphere"+n++,{color:r}).toggle(!0).update(t.position,l)}};function m(e){e.getModuleBySymbol(s.y.NAVIGATION).then((t=>{const i=t.navigationWalk,s=i.positionTracker;new p(e,s,i)}))}},83718:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var s=i(69984),n=i(97998),o=i(69170);const r=new n.Z("raycaster-debug");class a{constructor(e){Promise.all([e.getModuleBySymbol(o.y.SETTINGS),e.getModuleBySymbol(o.y.WEBGL_RENDERER),e.getModuleBySymbol(o.y.RAYCASTER)]).then((([e,t,i])=>{const n=t.getScene(),o=[];let a=!1;const h=()=>{o&&o.forEach((e=>{e.geometry.dispose(),e.material.dispose(),n.remove(e)}))},c=(e,t,a)=>{r.info("draw",{from:e,to:t,faces:a});const h=i.getOctree().getDebugBoundsMesh((0,s.rn)().getHex(),e,t,a);h.frustumCulled=!1,h.updateMatrixWorld(!0),n.add(h),o.push(h)};e.registerMenuButton({header:"Raycaster",buttonName:"Add Octree Level Buttons",callback:()=>{if(!a){for(let t=0;t<=i.getOctree().depth;t++)e.registerMenuButton({header:"Octree Levels",buttonName:`Anything on Level: ${t}`,callback:()=>{h(),c(t,t,!1)}});for(let t=0;t<=i.getOctree().depth;t++)e.registerMenuButton({header:"Octree Faces",buttonName:`Faces on Level: ${t}`,callback:()=>{h(),c(t,t,!0)}});a=!0}}}),e.registerMenuButton({header:"Raycaster",buttonName:"Visualize Octree - All",callback:()=>{h();for(let e=0;e<=i.getOctree().depth;e++)c(e,e,!1)}}),e.registerMenuButton({header:"Raycaster",buttonName:"Visualize Octree - Faces",callback:()=>{h();for(let e=0;e<=i.getOctree().depth;e++)c(e,e,!0)}}),e.registerMenuButton({header:"Raycaster",buttonName:"Clear Octree Visuals",callback:h})}))}}function h(e){new a(e)}},68427:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>m});var s=i(69170),n=i(81396),o=i(17798),r=i(2569),a=i(56512),h=i(90304),c=i(9037),l=i(85992),u=i(94046);const d=new(i(97998).Z)("raycaster-debug");var p;!function(e){e.normal="normal",e.hitClass="hitClass",e.hitBounds="hitBounds"}(p||(p={}));const g={color:"yellow"};class f{constructor(e){this.engine=e,this.cached={v1:new n.Vector3,v2:new n.Vector3,quat:new n.Quaternion},this.showClass=!1,this.showName=!0,this.showNormal=!1,this.showBounds=!1,this.drawRaycastHitNormal=e=>{const t=this.draw.line(p.normal,"red",4);e&&t.updatePositions(e.point,this.cached.v1.copy(e.point).addScaledVector(e.normal,.2)),t.toggle(null!==e)},this.drawRaycastObjectInfo=(e,t,i,s)=>{const n=this.draw.label(p.hitClass,"X",this.cached.v1,1);if(n.visible=!1,e&&t&&(i||s)){const{position:o,rotation:a}=t.pose,{point:c,object:l}=e,u=i?l.__proto__.constructor.name:"",d=s?""!==l.name?l.name:l.id:"";n.text=`${u} - ${d}`,n.setPosition(c,(e=>t.isOrtho()?e.addScaledVector(h.f.UP,10):(0,r.Xe)(o,e,1,e))),n.scaleBillboard(o,a,t.pose.projection,t.zoom(),t.height,t.aspect(),.1),n.setOrientation(a),n.visible=!0}},this.drawRaycastHitBounds=e=>{const t=this.draw.boxWire(p.hitBounds,g).toggle(!1);if(e&&e.object&&!(e.object instanceof u.i)&&e.object instanceof n.Mesh){const i=(0,a.A5)(e.object.geometry),s=i.getCenter(this.cached.v1).applyMatrix4(e.object.matrixWorld),n=i.getSize(this.cached.v2).multiply(e.object.scale).multiplyScalar(.5);t.mesh.quaternion.copy(e.object.quaternion),t.toggle(!0).update(s,n)}},this.onPointerDown=()=>{const e=this.data.hit;e&&e.object&&d.warn(e.object,e)},Promise.all([e.getModuleBySymbol(s.y.SETTINGS),e.market.waitForData(l.P)]).then((([e,t])=>{this.data=t;const i=t.onChanged((()=>this.update(t)));i.cancel();const s=e=>{e?(window.addEventListener("pointerdown",this.onPointerDown),i.renew()):(window.removeEventListener("pointerdown",this.onPointerDown),i.cancel(),this.draw.toggleAll(!1))};e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitDebugging",initialValue:()=>!1,onChange:e=>{s(e)},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitClass",initialValue:()=>this.showClass,onChange:e=>{this.showClass=e},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitName",initialValue:()=>this.showName,onChange:e=>{this.showName=e},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitNormal",initialValue:()=>this.showNormal,onChange:e=>{this.showNormal=e},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitBounds",initialValue:()=>this.showBounds,onChange:e=>{this.showBounds=e},urlParam:!0})}))}get draw(){return this._draw||(this._draw=new o.M({background:!1,color:"red"}),this.engine.getModuleBySymbol(s.y.WEBGL_RENDERER).then((e=>this._draw.addToScene(e.getScene())))),this._draw}update(e){const t=this.engine.market.tryGetData(c.M);this.showNormal&&this.drawRaycastHitNormal(e.hit),this.showBounds&&this.drawRaycastHitBounds(e.hit),this.drawRaycastObjectInfo(e.hit,t,this.showClass,this.showName)}}function m(e){new f(e)}},45053:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var s=i(69170),n=i(81396),o=i(3968),r=i(96666),a=i(51524);const h="Snapping";async function c(e){const[t,i,c]=await Promise.all([e.getModuleBySymbol(s.y.SETTINGS),await e.getModuleBySymbol(s.y.RAYCASTER),e.getModuleBySymbol(s.y.WEBGL_RENDERER)]),l=i.snapping,u=c.getScene().scene;t.registerMenuEntry({header:h,setting:"snappingMaxLOD",initialValue:()=>a.t.snappingMaxLOD,onChange:e=>{a.t.snappingMaxLOD=e},urlParam:!0,rangePrecision:0,range:[0,3]}),function(e,t,i){const s=new n.BufferGeometry,r=new n.LineSegments(s,new n.LineBasicMaterial({vertexColors:!0}));r.frustumCulled=!1;const a=new n.SphereGeometry(.02,5,5);let c;const l=[16711680,65280,255,16777215],u=new n.Color,d=(new n.Matrix4).identity(),p=new n.Group;let g;function f(){const e=[],i=[],h=[],g=[];t.forEachSnapFeature((t=>{var s,n,r;if(u.setHex(l[(null===(r=null===(n=null===(s=t.meta)||void 0===s?void 0:s.tile)||void 0===n?void 0:n.extras)||void 0===r?void 0:r.level)||0]),t instanceof o.FM){const{start:s,end:n}=t;e.push(s.x,s.y,s.z,n.x,n.y,n.z),i.push(u.r,u.g,u.b,u.r,u.g,u.b)}else t instanceof o.UQ&&(h.push(t.x,t.y,t.z),g.push(u.r,u.g,u.b))}),!0),s.dispose(),s.setAttribute("position",new n.Float32BufferAttribute(e,3)),s.setAttribute("color",new n.Float32BufferAttribute(i,3)),c&&3*c.count===h.length||(c&&(p.remove(c),null==c||c.dispose()),c=new n.InstancedMesh(a,new n.MeshBasicMaterial,h.length/3));for(let e=0;e<h.length;e+=3)c.setMatrixAt(e/3,d.setPosition(h[e],h[e+1],h[e+2])),c.setColorAt(e/3,u.setRGB(g[e],g[e+1],g[e+2]));p.add(r,c)}e.registerMenuEntry({header:h,setting:"Show Snapping Features",initialValue:()=>!1,onChange(e){e?(i.add(p),g=setInterval(f,300)):(null==c||c.dispose(),a.dispose(),s.dispose(),i.remove(p),clearInterval(g))}})}(t,l,u),function(e,t,i,s){const o=[];let a,c;function l(){c||(c=new n.Mesh(new n.BufferGeometry,new n.MeshBasicMaterial({vertexColors:!0})),c.frustumCulled=!1,i.add(c));const e=[],t=[];for(const i of o){let s=0;for(const n of i.surfaces){const i=n.area>.1,o=Math.sin(s++)/2+.5,r=i?0:.2+.8*o,a=i?.2+.8*o:0,h=0;for(const i of n.faces){const s=i.va.vector,n=i.vb.vector,o=i.vc.vector;e.push(s.x,s.y,s.z),e.push(n.x,n.y,n.z),e.push(o.x,o.y,o.z),t.push(r,a,h,r,a,h,r,a,h)}}}c.geometry.dispose(),c.geometry.setAttribute("position",new n.Float32BufferAttribute(e,3)),c.geometry.setAttribute("color",new n.Float32BufferAttribute(t,3))}function u(e){o.push(e.edgeFinder)}[{header:h,setting:"Collect Snapping Surfaces",initialValue:()=>!1,onChange(e){e?s.subscribe(r.x,u):(s.unsubscribe(r.x,u),o.length=0)}},{header:"Snapping",setting:"Show Snapping Surfaces",initialValue:()=>!1,onChange(e){clearInterval(a),e?a=setInterval((()=>{t.preloadMeshSnapping(),l()}),1e3):c&&(c.geometry.dispose(),i.remove(c),c=null)}}].forEach((t=>e.registerMenuEntry(t)))}(t,l,u,e)}},41036:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PanoPreloadVisualizer:()=>b,default:()=>x});var s=i(97998),n=i(69170),o=i(17798),r=i(48917),a=i(9037),h=i(85992),c=i(53954),l=i(20573),u=i(23254),d=i(63252),p=i(81396),g=i(90304),f=i(12039),m=i(67944),y=i(64918);const w=new s.Z("previs");class b{constructor(e,t,i){this.engine=e,this.downloadDescriptorGetter=t,this.prioritizer=i,this.allPreloadedSweeps=new Set,this.active=!1,this.freezeCameraRotation=!1,this.sweepIndex=50,this.useCurrentCriteria=!0,this.showPreloadIds=!0,this.visualTour=!1,this.showSweepLabels=!1,this.criteria=new l.I(null,new p.Vector3,new p.Vector3),this.draw=new o.M,this.engine.getModuleBySymbol(n.y.WEBGL_RENDERER).then((e=>this.draw.addToScene(e.getScene()))),this.engine.market.waitForData(h.P).then((e=>{this.subscription=e.onChanged((()=>this.update(this.draw))),this.subscription.cancel()}));const s=this.engine.market.tryGetData(c.Z);if(s){this.sweepData=s;const e=s.getSweepList(),t=new r.Z((e=>e.id));for(let i of e)i.isObservableProxy&&(i=(new d.ZP).copy(i)),t.add(i);this.sweepMap=t}this.engine.getModuleBySymbol(n.y.SETTINGS).then((e=>{const t="Pano Preload",i=[{header:t,setting:"ShowVis",initialValue:()=>this.active,onChange:e=>this.toggle(e)},{header:t,setting:"Use Camera",initialValue:()=>this.useCurrentCriteria,onChange:e=>{this.useCurrentCriteria=e,this.update(this.draw)}},{header:t,setting:"Freeze Rotation",initialValue:()=>this.freezeCameraRotation,onChange:e=>{this.freezeCameraRotation=e,this.update(this.draw)}},{header:t,setting:"Show preload ids",initialValue:()=>this.showPreloadIds,onChange:e=>{this.showPreloadIds=e,this.update(this.draw)}},{header:t,setting:"Visual tour",initialValue:()=>this.visualTour,onChange:e=>{this.visualTour=e,this.update(this.draw)}},{header:t,setting:"Pano labels",initialValue:()=>this.showSweepLabels,onChange:e=>{this.showSweepLabels=e,this.update(this.draw)}},{header:t,setting:"Override Sweep",initialValue:()=>0,onChange:e=>this.updateSweepIndex(e),range:[0,this.sweepMap.count()]}];e.registerMenuButton({header:"Pano Preload tour",buttonName:"Tour",callback:()=>{this.activateTourMode()}}),i.forEach((t=>e.registerMenuEntry(t)))}))}updateSweepIndex(e){const t=Math.round(e);this.sweepIndex=t,this.update(this.draw)}toggle(e){this.active!==e&&(e&&this.subscription.renew(),e||(this.subscription.cancel(),this.draw.toggleAll(!1)),this.active=e)}update(e){const t=this.engine.market.tryGetData(c.Z),i=this.engine.market.tryGetData(a.M),s=this.engine.market.tryGetData(u.O);if(!(e&&t&&i&&s))return;if(!this.active||!this.sweepMap)return;if(this.tourMode&&!this.visualTour)return;const n=t.getSweepList(),o=this.useCurrentCriteria?this.prioritizer.priorityCriteria:Object.assign({},this.criteria);if(this.useCurrentCriteria){if(this.freezeCameraRotation){if(!o.sweep)return;o.cameraPosition.copy(o.sweep.position),o.cameraRot.copy(this.lastCriteria.cameraRot),o.cameraDir.copy(g.f.FORWARD).applyQuaternion(this.lastCriteria.cameraRot)}}else if(o.sweep=this.sweepData.getSweepByIndex(this.sweepIndex)||null,!this.freezeCameraRotation){if(!o.sweep)return;o.cameraPosition.copy(o.sweep.position),o.cameraRot.copy(i.pose.rotation),o.cameraDir.copy(g.f.FORWARD).applyQuaternion(o.cameraRot)}if(this.lastCriteria=Object.assign({},o),!o.sweep)return;this.tourMode||this.wipePreloadedData();const r=[];this.prioritizer.priorityCriteria=o,this.prioritizer.filterAndPrioritize(r,this.sweepMap,this.downloadDescriptorGetter);const h=new Set;let l="";for(const e of r)e&&e.sweep&&(h.has(e.sweep.id)||(h.add(e.sweep.id),l+=`${e.sweep.index}, `),this.allPreloadedSweeps.has(e.sweep.id)||this.allPreloadedSweeps.add(e.sweep.id));const d=new p.Vector3(0,0,-1.5).applyQuaternion(i.pose.rotation),f=(new p.Vector3).copy(i.pose.position).add(d),m=`Current Pano: ${o.sweep.index}\n    ${this.showPreloadIds?`Panos: ${l}`:""}\n    Preload Count (this pano): ${h.size}\n    Total Preloaded: ${this.allPreloadedSweeps.size}`,y=e.label("infoLabel",m,f,.1);if(y.lookAt(i.pose.position),y.setPosition(f),y.text=m,this.drawSweepSpheres(h,o),this.showSweepLabels)for(const t of n){const s=`${t.index}`,n=e.label(t.id,s,t.position,.1);n.text=s,n.setColorHex(16711680),n.lookAt(i.pose.position)}}drawSweepSpheres(e,t){const i=t.sweep;if(!i)return;this.draw.toggleAll(!1);const s=(new p.Vector3).copy(i.position);s.y+=-.5;for(const t of e){const e=this.sweepData.getSweep(t),n=i===e,o=n?"green":"white",r=(new p.Vector3).copy(e.position);if(r.y+=-.5,this.draw.sphere(e.id+"sphere"+(n&&"source"),{color:o,opacity:1}).update(r,.2).toggle(!0),!n){const t=this.draw.line(`${e.id}-${i.id}`,"white",.05);t.updatePositions(r,s),t.toggle(!0)}}}activateTourMode(){this.tourMode=!0;const e={},t=Math.round(this.sweepIndex),i=this.sweepData.getSweepByIndex(t);i&&this.engine.commandBinder.issueCommand(new f.ju({sweep:i.id})).then((()=>{this.wipePreloadedData(),this.allPreloadedSweeps.clear();const t=this.sweepData.getSweepList(),s=Math.round(.05*t.length);i&&this.tourStep(i,e,s)}))}tourStep(e,t,i,s=0,n=""){const o=e,r=this.sweepData.getSweepList();let a=e;if(!o||o.neighbours.length<=0)return;t[o.id]=!0,n+=`Sweep: ${o.index} Loaded: ${this.allPreloadedSweeps.size}\n`;let h=0;for(;h<r.length;){const e=(o.index+1+h)%r.length,i=this.sweepData.getSweepByIndex(e);if(h++,i&&(a=i,!t[a.id]&&a.id!==o.id&&a))break}if(++s<=i)if(this.visualTour)this.engine.commandBinder.issueCommand(new f.ju({sweep:o.id,rotation:(0,m.n0)(o.position,a.position),transition:y.n.Interpolate})).then((()=>{setTimeout((()=>{this.tourStep(a,t,i,s,n)}),500)}));else{const e=(0,m.n0)(o.position,a.position),r=(new p.Vector3).copy(g.f.FORWARD).applyQuaternion(e),h=new l.I(o,o.position,r),c=[];this.prioritizer.priorityCriteria=h,this.prioritizer.filterAndPrioritize(c,this.sweepMap,this.downloadDescriptorGetter);this.queueToPanoSet(c).forEach((e=>this.allPreloadedSweeps.add(e))),this.tourStep(a,t,i,s,n)}else w.info(`TOUR END\n      Sweeps visited: ${s}\n      Visual: ${this.visualTour}\n      Sweeps preloaded: ${this.allPreloadedSweeps.size}`),w.info(`TOUR INFO\n      ${n}`),this.tourMode=!1}queueToPanoSet(e){const t=new Set;for(const i of e)i&&i.sweep&&(t.has(i.sweep.id)||t.add(i.sweep.id));return t}wipePreloadedData(){const e=this.sweepData.getSweepList();for(const t of e)this.downloadDescriptorGetter.deleteAllTileDownloadDescriptors(t.id)}}function x(e){e.getModuleBySymbol(n.y.SWEEP_PANO).then((t=>{const i=t;"tileDownloader"in i&&new b(e,i.tileDownloader,i.tilePrioritizer)}))}},96769:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n});var s=i(69170);async function n(e){const[t,i]=await Promise.all([e.getModuleBySymbol(s.y.SETTINGS),e.getModuleBySymbol(s.y.WEBGL_RENDERER)]),n="WebGL Renderer";let o=null;function r(e){i.threeRenderer.forceContextLoss(),setTimeout((()=>{i.threeRenderer.forceContextRestore()}),e)}t.registerMenuButton({header:n,buttonName:"Lose Context for 0.1 sec",callback:()=>{r(100)}}),t.registerMenuButton({header:n,buttonName:"Lose Context for 5 sec",callback:()=>{r(5e3)}}),t.registerMenuEntry({header:n,setting:"autoLoseContext",initialValue:()=>!1,urlParam:!0,onChange(e){if(e){const e=()=>r(100);e(),o=setInterval(e,1e4)}else clearInterval(o)}})}},17798:(e,t,i)=>{"use strict";i.d(t,{M:()=>M});var s=i(90304),n=i(81396);class o{constructor(e,t,i){return this.thisType=e,this.container=t,this.mesh=i(),this.mesh.name=`${e.name}`,this.material=this.mesh.material,this.geometry=this.mesh.geometry,this}opacity(e){return this.material.opacity=e,this}}function r(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((i=>{e.prototype[i]=t.prototype[i]}))}))}class a{constructor(){this.animationInit=!1}initAnimationMixin(e,t){this.animState={scale:t?t.clone():new n.Vector3(1,1,1),position:e?e.clone():new n.Vector3,target:{scale:t?t.clone():new n.Vector3(1,1,1),position:e?e.clone():new n.Vector3},temp:{pos:new n.Vector3,scale:new n.Vector3,makeScale:new n.Vector3}},this.animationInit=!0}update(e,t){if(!this.animationInit)throw Error(`${a.name} call this.initAnimationMixin() in ${this.style} constructor to enable update, because I said so.`);this.mesh.position.copy(e);const i=this.vector3From(t);return i.equals(this.mesh.scale)||this.mesh.scale.copy(i),this.animState.scale.copy(this.mesh.scale),this.animState.position.copy(this.mesh.position),this.mesh.updateMatrixWorld(!0),this}animate(e,t,i){if(!this.animationInit)throw Error(`${a.name} call this.initAnimationMixin() in ${this.style} constructor to enable animations, because I said so.`);const s=this.vector3From(i);this.animState.target.scale.copy(s),this.animState.target.position.copy(t);const n=this.animState.temp.pos.copy(this.mesh.position).lerp(t,e),o=this.animState.temp.scale.copy(this.mesh.scale).lerp(s,e);return this.update(n,o),this}vector3From(e){if(e instanceof n.Vector3)return this.animState.temp.makeScale.copy(e).clamp(c,l);if("number"==typeof e)return this.animState.temp.makeScale.set(e,e,e).clamp(c,l);throw Error("Unexpected scale input")}}const h=.01,c=new n.Vector3(h,h,h),l=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);class u{toggle(e){return e?this.container.add(this.mesh):this.container.remove(this.mesh),this.isVisible=e,this}}class d extends o{constructor(e,t){super(d,e,(()=>new n.Mesh(new n.BoxGeometry(1,1,1),new n.MeshBasicMaterial(t)))),this.container=e,this.style="Box",this.mesh.frustumCulled=!1,this.geometry.computeBoundingBox(),this.initAnimationMixin()}}r(d,[a,u]);class p extends o{constructor(e,t){super(p,e,(()=>{const e=new n.Box3Helper((new n.Box3).setFromCenterAndSize(new n.Vector3,new n.Vector3(1,1,1)));return new n.LineSegments(e.geometry,e.material)})),this.container=e,this.style="BoxWireframeMesh",t&&this.material.setValues(t),this.mesh.frustumCulled=!1,this.initAnimationMixin()}}r(p,[u,a]);class g extends o{constructor(e,t){super(g,e,(()=>new n.CameraHelper(t))),this.container=e,this.style="CameraHelper",this.updateCamera(t)}updateCamera(e){return this.mesh.camera.copy(this.camWithSaneFarDistance(e)),this.mesh.update(),this}camWithSaneFarDistance(e){const t=e.clone();return t.far=5,t}}r(g,[u]);class f extends o{constructor(e,t){super(f,e,(()=>new n.Mesh(new n.PlaneGeometry(1),new n.MeshBasicMaterial(t)))),this.container=e,this.style="PlaneMesh",this.radius=1;const i=new n.Matrix4;i.makeRotationFromEuler(new n.Euler(-Math.PI/2,0,0,"XYZ")),this.geometry.applyMatrix4(i),this.mesh.frustumCulled=!1,this.initAnimationMixin()}}r(f,[u,a]);class m extends o{constructor(e,t){super(m,e,(()=>new n.Mesh(new n.SphereGeometry(1),new n.MeshBasicMaterial(t)))),this.container=e,this.style="SphereMesh",this.radius=1,this.mesh.frustumCulled=!1,this.initAnimationMixin()}}r(m,[u,a]);var y=i(15462);class w extends o{constructor(e,t){return super(w,e,(()=>new n.Line(new n.BufferGeometry,new n.LineBasicMaterial(Object.assign({color:y.I.MP_BRAND,opacity:1,transparent:!0},t))))),this.container=e,this.positionsBuffer=new n.BufferAttribute(new Float32Array(150),3),this.point=new n.Vector3,this.points={start:new n.Vector3,control:new n.Vector3,end:new n.Vector3},this.updatePoints=(e,t,i)=>{this.points.start.copy(this.curve.v0.copy(e)),this.points.control.copy(this.curve.v1.copy(t)),this.points.end.copy(this.curve.v2.copy(i));for(let e=0;e<50;e++){const t=e/49;this.curve.getPoint(t,this.point),this.positionsBuffer.setXYZ(e,this.point.x,this.point.y,this.point.z)}return this.positionsBuffer.needsUpdate=!0,this},this.animatePoints=(e,t,i,s)=>{const{start:n,control:o,end:r}=this.points;return n.equals(o)&&n.equals(r)?(this.updatePoints(t,i,s),this):(n.lerp(t,e),o.lerp(i,e),r.lerp(s,e),this.updatePoints(n,o,r),this)},this.mesh.frustumCulled=!1,this.curve=new n.QuadraticBezierCurve3(new n.Vector3,new n.Vector3,new n.Vector3),this.geometry.setAttribute("position",this.positionsBuffer),this.geometry.computeBoundingBox(),this}}r(w,[u]);var b=i(78449),x=i(85255),v=i(48786);class M{constructor(e,t={}){this.cache={},this.helperCache={},this.style={},this.toggle=e=>(this.options.scene&&(e?this.options.scene.add(this.options.container):this.options.scene.remove(this.options.container)),this),this.box=(e,t)=>(this.cache[B.box][e]||(this.cache[B.box][e]=new d(this.options.container,t).toggle(!0)),this.cache[B.box][e]),this.boxWire=(e,t)=>(this.cache[B.boxWire][e]||(this.cache[B.boxWire][e]=new p(this.options.container,t).toggle(!0)),this.cache[B.boxWire][e]),this.cam=(e,t)=>(this.cache[B.cameraHelper][e]||(this.cache[B.cameraHelper][e]=new g(this.options.container,t).toggle(!0)),this.cache[B.cameraHelper][e]),this.label=(e,t,i,s=.25)=>{if(!this.labelCreator){const{color:e,backgroundColor:t,backgroundOpacity:i,background:s}=this.options;this.labelCreator=new b.uc(Object.assign({color:e,background:s,backgroundColor:t,backgroundOpacity:i,wordWrapWidth:650},this.style))}if(!this.cache[B.label][e]){const n=this.labelCreator.createLabel();this.cache[B.label][e]=n,n.position.copy(i),n.text=t,n.scaleFactor=s,this.options.container.add(n)}return this.cache[B.label][e]},this.line=(e,t=this.options.lineColor,i=this.options.linewidth)=>{if(!this.cache[B.line][e]){const o=(0,x.makeLineMaterial)("string"==typeof t?new n.Color(t).getHex():t.getHex(),!1,{linewidth:i}),r={onShow:()=>this.options.container.add(...a.children),onHide:()=>this.options.container.remove(...a.children)},a=new v.c(s.f.ZERO.clone(),s.f.ZERO.clone(),o,r);a.updateResolution(window.innerWidth,window.innerHeight).opacity(1).toggle(!0),this.cache[B.line][e]=a}return this.cache[B.line][e]},this.plane=(e,t)=>(this.cache[B.plane][e]||(this.cache[B.plane][e]=new f(this.options.container,t).toggle(!0)),this.cache[B.plane][e]),this.setStyle=e=>{this.style=e},this.sphere=(e,t)=>(this.cache[B.sphere][e]||(this.cache[B.sphere][e]=new m(this.options.container,t).toggle(!0)),this.cache[B.sphere][e]),this.triangle=(e,t,i,s,o)=>{if(!this.cache[B.triangle][e]){const r=new Float32Array(9);t.toArray(r,0),i.toArray(r,3),s.toArray(r,6);const a=new n.BufferGeometry;a.setAttribute("position",new n.BufferAttribute(r,3));const h=new n.Mesh(a,new n.MeshBasicMaterial(o));this.options.container.add(h),this.cache[B.triangle][e]=new m(this.options.container,o).toggle(!0)}return this.cache[B.triangle][e]},this.spline=(e,t)=>(this.cache[B.spline][e]||(this.cache[B.spline][e]=new w(this.options.container,t).toggle(!0)),this.cache[B.spline][e]),this.randomColor=e=>{if(void 0!==e){if(!this.helperCache[A.color][e]){const t=new n.Color(S(),S(),S());this.helperCache[A.color][e]=t}return this.helperCache[A.color][e]}return new n.Color(S(),S(),S())},this.randomVector3=e=>{if(void 0!==e){if(!this.helperCache[A.vector3][e]){const t=new n.Vector3(2*(.5-S()),2*(.5-S()),2*(.5-S()));this.helperCache[A.vector3][e]=t}return this.helperCache[A.vector3][e]}return new n.Vector3(2*(.5-S()),2*(.5-S()),2*(.5-S()))},this.toggleAll=e=>{for(const t of Object.values(B)){const i=Object.values(this.cache[t]);for(const t of i)"toggle"in t&&t.toggle(e)}return this},this.options=Object.assign(Object.assign({},C),e),this.style=t;for(const e of Object.values(B))this.cache[e]={};for(const e of Object.values(A))this.helperCache[e]={};this.options.scene&&this.toggle(!0)}async addToScene(e){return this.options.scene=e,this.toggle(!0),this}}const S=()=>Math.random(),C={lineColor:"white",linewidth:2,color:"white",background:!0,backgroundColor:"white",backgroundOpacity:.5,container:new n.Group};var B,A;!function(e){e.box="box",e.boxWire="boxWire",e.label="label",e.line="line",e.plane="plane",e.sphere="sphere",e.spline="spline",e.triangle="triangle",e.cameraHelper="cameraHelper"}(B||(B={})),function(e){e.color="color",e.vector3="vector3"}(A||(A={}))},21270:(e,t,i)=>{"use strict";var s;i.d(t,{V:()=>s}),function(e){e[e.Min=0]="Min",e[e.Standard=1]="Standard",e[e.High=2]="High",e[e.Detail=3]="Detail"}(s||(s={}))},51524:(e,t,i)=>{"use strict";i.d(t,{t:()=>a});var s=i(59279),n=i(53261),o=i(31362),r=i(21270);const a={urlTemplateToken:"<file>",initialMaxLOD:r.V.Min,nonMeshMaxLOD:r.V.Standard,maxLOD:r.V.High,minLOD:r.V.Min,loadSiblings:!0,displayActiveTiles:!1,autoDisableRendererCulling:!0,optimizeRaycast:!1,stopAtEmptyTiles:!1,disableTileUpdates:!1,disposeModel:!1,limitMemoryUsage:(0,o.tq)(),allocatedMegsBeforeLimitingLod:350,lruMinExtraTiles:(0,o.tq)()?0:100,lruMaxTiles:800,lruUnloadPercent:.05,tileAssetRequestPriority:n.ru.MEDIUM,downloadQueueConcurrency:8,parseQueueConcurrency:10,snappingMaxLOD:r.V.Standard,errorTarget:Number((0,s.eY)("errorTarget",(0,o.tq)()?6:4)),errorMultiplierHiddenFloors:.01,errorMultiplierRaycastOcclusion:.1}},69984:(e,t,i)=>{"use strict";i.d(t,{D5:()=>c,Ex:()=>l,G1:()=>a,rn:()=>h});var s=i(81396),n=i(39880);const o=()=>Math.random(),r={},a=(e,t=o())=>(r[t]||(r[t]=new s.Vector4(o(),o(),o(),e)),r[t]),h=()=>new s.Color(o(),o(),o()),c=e=>e instanceof Object&&"r"in e&&"g"in e&&"b"in e;function l(e){return`#${(0,n.Q_)(255*e.r,2,"0",16)}${(0,n.Q_)(255*e.g,2,"0",16)}${(0,n.Q_)(255*e.b,2,"0",16)}`}},78449:(e,t,i)=>{"use strict";i.d(t,{$7:()=>y,uc:()=>b,N3:()=>m});var s=i(81396),n=i(45837),o=i(90304),r=i(59370),a=i(69505),h=i(49827),c=i(67944),l=i(67557),u=i(7531),d=i.n(u),p=i(87804),g=i.n(p);class f extends s.Mesh{}var m;!function(e){e.WORLD="world",e.NDC="ndc"}(m||(m={}));class y extends s.Object3D{constructor(e,t=l.Qi.instance,i=m.WORLD){var r;super(),this.config=e,this.fontManager=t,this.scaleType=i,this.bindings=[],this.update=()=>{const e=this.resolvedConfig;this.textGeometry.update(e),this.textGeometry.computeBoundingBox();const t=this.textGeometry.layout.lineHeight-this.textGeometry.layout.baseline;this.labelTextMesh.position.x=-.5*this.textGeometry.layout.width+t,this.labelTextMesh.position.y=-.5*this.textGeometry.layout.height+t,this.labelTextMesh.position.z=.25,this.unscaledWidth=this.textGeometry.layout.width+this.config.backgroundBorderWidth,this.unscaledHeight=this.textGeometry.layout.height+this.config.backgroundBorderHeight,(this.labelBackgroundMesh||this.config.backgroundAsCollider)&&this.labelBackgroundMesh.scale.set(this.unscaledWidth,this.unscaledHeight,.01),this.aspect=this.unscaledWidth/Math.max(this.unscaledHeight,.001),this.fontHeightToMeters=1/e.font.info.size,this.updateScale(),this._onGeomUpdate&&this._onGeomUpdate()};const h=void 0!==this.config.opacity?this.config.opacity:1;if(this.config.background||this.config.backgroundAsCollider){this.config.backgroundOpacity=void 0!==this.config.backgroundOpacity?this.config.backgroundOpacity:1,this.config.backgroundOpacity=this.config.background?this.config.backgroundOpacity:0;const t=new s.BoxGeometry(1,1,.01),i=new s.MeshBasicMaterial({color:e.backgroundColor,transparent:!0,depthTest:this.config.backgroundOpacity>0&&!e.disableDepth,depthWrite:this.config.backgroundOpacity>0&&!e.disableDepth,opacity:this.config.backgroundOpacity,stencilRef:1,stencilFail:s.KeepStencilOp,stencilZFail:s.KeepStencilOp,stencilZPass:s.ReplaceStencilOp,stencilFunc:s.AlwaysStencilFunc,stencilWrite:!0});this.labelBackgroundMesh=new this.config.backgroundColliderType(t,i),this.labelBackgroundMesh.position.z=-.25,this.labelBackgroundMesh.name="Label Background",this.collider=this.labelBackgroundMesh,this.add(this.labelBackgroundMesh)}const c={fontPath:`${null!==(r=e.assetBasePath)&&void 0!==r?r:""}${l.Ye.fontPath}`,outline:this.config.outline,outlineWidth:this.config.outlineWidth},u={uniforms:{map:{type:"t",value:(p=Object.assign(Object.assign({},c),{color:e.color,opacity:h})).map},color:{type:"c",value:new s.Color(p.color)},opacity:{type:"f",value:p.opacity}},vertexShader:d(),fragmentShader:g()};var p;const y=new s.RawShaderMaterial({uniforms:u.uniforms,fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,side:s.DoubleSide,transparent:!0,depthTest:!1,depthWrite:!1,opacity:h});y.name="Label Text",this.fontId=this.fontManager.getFontId(c);const w=this.fontManager.getFont(this.fontId);y.uniforms.map.value=w.textures[0],this.bindings.push(w.onChanged((()=>{y.uniforms.map.value=w.textures[0],this.update()})));const b=this.resolvedConfig,x=b.font;this.textGeometry=(0,n.Y)(b),this.labelTextMesh=new f(this.textGeometry,y),this.labelTextMesh.name="Label Text",this.labelTextMesh.renderOrder=10;const v=(new s.Quaternion).setFromAxisAngle(o.f.FORWARD,(0,a.Id)(180)),M=(new s.Quaternion).setFromAxisAngle(o.f.UP,(0,a.Id)(180));this.labelTextMesh.quaternion.multiply(v).multiply(M),this.add(this.labelTextMesh),this.name="Label Container",this.fontHeightToMeters=1/x.info.size,this.scaleFactor=e.scale||this.fontHeightToMeters,this.update()}dispose(){this.bindings.forEach((e=>e.cancel())),this.textGeometry.dispose()}get resolvedConfig(){let e;if(void 0!==this.config.wordWrapWidth){const t=this.fontManager.measureText(this.fontId,this.config.text);void 0!==t&&t>this.config.wordWrapWidth&&(e=this.config.wordWrapWidth)}const t=this.fontManager.getFont(this.fontId);return Object.assign(Object.assign({},this.config),{font:t.fontData,texture:t.textures[0],width:e})}onGeomUpdate(e){this._onGeomUpdate=e}updateScale(){const e=this.config.scale*this.fontHeightToMeters;this.scale.set(e,e,e)}get text(){return this.config.text}set text(e){e!==this.name&&(this.config.text=e,this.name=e,this.fontManager.getFont(this.fontId).addCharsIfNeeded(e),this.update())}get mesh(){return this.labelTextMesh}get scaleFactor(){return this.config.scale}set scaleFactor(e){this.scaleFactor!==e&&(this.config.scale=e,this.updateScale())}get opacity(){return void 0!==this.config.opacity?this.config.opacity:1}set opacity(e){if(e!==this.config.opacity){this.config.opacity=e;const t=e>0&&!this.config.disableDepth;if(this.config.background){const i=this.labelBackgroundMesh.material;i.opacity=Math.min(this.config.backgroundOpacity||1,e),i.depthWrite=e>.15,i.depthTest=t}const i=this.labelTextMesh.material;i.uniforms.opacity.value=e,i.depthTest=t,this.visible=e>0}}setColorHex(e){const t=this.labelTextMesh.material.uniforms.color;t.value.getHex()!==e&&t.value.setHex(e)}setRenderLayer(e){this.labelTextMesh.layers.mask=e.mask,this.labelBackgroundMesh&&(this.labelBackgroundMesh.layers.mask=e.mask)}setRenderOrder(e){this.renderOrder=e,this.labelTextMesh.renderOrder=e,this.labelBackgroundMesh&&(this.labelBackgroundMesh.renderOrder=e)}setPosition(e,t=(e=>e)){this.position.copy(t(e))}setOrientation(e,t=0){this.quaternion.copy(e),0!==t&&this.rotateZ(-t*a.Ue)}scaleBillboard(e,t,i,s,n,o,a=w.SCALE_DEFAULT){if(0!==i.elements[15])this.scaleFactor=.2*a*s*(w.ORTHO_IDEAL_HEIGHT/n);else{const l=(0,r.D_)(this.position,e,t,i.asThreeMatrix4()),u=Math.abs(l.x);if(u<1){const t=(0,c.mY)(i,e,this.position,n,a),r=((0,h.uZ)(o,1,2.5)+s)*w.SCALE_ASPECT,l=1+w.SCALE_NDC-u*w.SCALE_NDC-r,d=Math.max(Math.min(1/t*l,3),.001);this.scaleType===m.NDC?this.scaleFactor=d:this.scaleFactor=Math.min(d*w.NDC_MULT,a*w.SCALE_WORLD)}else this.scaleFactor=.001}this.updateScale()}}const w={SCALE_DEFAULT:.1,SCALE_WORLD:4,SCALE_NDC:.5,SCALE_ASPECT:.035,DEPTH_WRITE_THRESHOD:.15,ORTHO_IDEAL_HEIGHT:1500,NDC_MULT:1.15};class b{constructor(e){this.currentTextConfig=b.defaultTextConfig,e?this.updateTextStyle(e):this.updateTextStyle(b.defaultTextConfig)}updateTextStyle(e){this.currentTextConfig=Object.assign(Object.assign({},this.currentTextConfig),e)}createLabel(e={text:""}){return new y(Object.assign(Object.assign({},this.currentTextConfig),e))}static makeConfig(e){return Object.assign(Object.assign({},b.defaultTextConfig),e)}}b.defaultTextConfig={text:"",align:"center",wordWrapWidth:void 0,color:"black",backgroundColor:"white",backgroundBorderWidth:50,backgroundBorderHeight:30,background:!0,backgroundAsCollider:!0,backgroundColliderType:s.Mesh,scale:1,outline:!1,outlineWidth:4}},87804:e=>{e.exports="precision highp float;precision highp int;uniform sampler2D map;uniform vec3 color;uniform float opacity;varying vec2 vUv;void main(){vec4 sample=texture2D(map,vUv).rgba;gl_FragColor=vec4(sample.rgb*color.rgb,clamp(sample.a*opacity,0.,1.));}"},7531:e=>{e.exports="precision highp float;precision highp int;attribute vec2 uv;attribute vec4 position;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*position;}"},12739:e=>{var t=/\n/,i="\n",s=/\s/;function n(e,t,i,s){var n=e.indexOf(t,i);return-1===n||n>s?s:n}function o(e){return s.test(e)}function r(e,t,i,s){return{start:t,end:t+Math.min(s,i-t)}}e.exports=function(t,i){return e.exports.lines(t,i).map((function(e){return t.substring(e.start,e.end)})).join("\n")},e.exports.lines=function(e,s){if(0===(s=s||{}).width&&"nowrap"!==s.mode)return[];e=e||"";var a="number"==typeof s.width?s.width:Number.MAX_VALUE,h=Math.max(0,s.start||0),c="number"==typeof s.end?s.end:e.length,l=s.mode,u=s.measure||r;return"pre"===l?function(e,i,s,n,o){for(var r=[],a=s,h=s;h<n&&h<i.length;h++){var c=i.charAt(h),l=t.test(c);if(l||h===n-1){var u=e(i,a,l?h:h+1,o);r.push(u),a=h+1}}return r}(u,e,h,c,a):function(e,t,s,r,a,h){var c=[],l=a;"nowrap"===h&&(l=Number.MAX_VALUE);for(;s<r&&s<t.length;){for(var u=n(t,i,s,r);s<u&&o(t.charAt(s));)s++;var d=e(t,s,u,l),p=s+(d.end-d.start),g=p+i.length;if(p<u){for(;p>s&&!o(t.charAt(p));)p--;if(p===s)g>s+i.length&&g--,p=g;else for(g=p;p>s&&o(t.charAt(p-i.length));)p--}if(p>=s){var f=e(t,s,p,l);c.push(f)}s=g}return c}(u,e,h,c,a,l)}},47529:e=>{e.exports=function(){for(var e={},i=0;i<arguments.length;i++){var s=arguments[i];for(var n in s)t.call(s,n)&&(e[n]=s[n])}return e};var t=Object.prototype.hasOwnProperty}}]);